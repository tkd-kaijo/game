<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å‘¨æœŸè¡¨ãƒ†ãƒˆãƒªã‚¹ v2ï¼ˆ1ã€œ36ï¼‹1/2/17/18æ— å…¨ç¯„å›²ã€iPadå¯¾å¿œï¼‰</title>
<style>
  :root {
    --bg: #0f172a;
    --panel: #111827;
    --grid: #1f2937;
    --text: #e5e7eb;
    --accent: #22d3ee;
    --ok: #34d399;
    --bad: #f87171;
    --ghost: #374151;
    --cell-gap: 2px;
    --cell-size: 38px; /* JSã§ä¸Šæ›¸ãã—ã¦ç”»é¢å¹…ã„ã£ã±ã„ã« */
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN",
    "Noto Sans JP", "Yu Gothic UI", "Yu Gothic", Meiryo, sans-serif;
    background: radial-gradient(1200px 800px at 70% 10%, #111827 0%, #0b1222 35%, #0f172a 70%);
    color: var(--text); display: grid; place-items: start center; min-height: 100dvh; padding: 16px;
  }
  .app { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 1fr 320px; gap: 16px; }
  @media (max-width: 980px) { .app { grid-template-columns: 1fr; } }

  .board-wrap { width: 100%; background: color-mix(in oklab, var(--panel) 80%, black 20%);
    padding: 12px; border: 1px solid #334155; border-radius: 16px; position: relative;
    box-shadow: 0 10px 40px rgba(0,0,0,.35); }
  .board { width: 100%; display: grid; grid-template-columns: repeat(18, var(--cell-size));
    grid-template-rows: repeat(7, var(--cell-size)); gap: var(--cell-gap); position: relative; }
  .cell { width: var(--cell-size); height: var(--cell-size); background: var(--grid);
    border-radius: 8px; display: grid; place-items: center; font-weight: 700; font-size: 13px; color: #cbd5e1;
    position: relative; overflow: hidden; user-select: none; touch-action: manipulation; }
  .cell.invalid { background: #0b1222; opacity: .35 }
  .cell.filled { background: #0e3b2d; }
  .cell .small { position: absolute; bottom: 2px; right: 6px; font-size: 10px; opacity: .6; font-weight: 500; }

  .falling { position: absolute; transform: translate(-50%, -50%); width: var(--cell-size); height: var(--cell-size);
    background: #1f2937; border: 2px solid var(--accent); border-radius: 8px; display: grid; place-items: center;
    text-align: center; pointer-events: none; box-shadow: 0 10px 30px rgba(0,0,0,.45); }
  .falling .wrap { display: grid; gap: 2px; }
  .falling .sym { font-weight: 900; letter-spacing: .5px; font-size: clamp(12px, calc(var(--cell-size)*0.42), 28px); }
  .falling .jp { font-size: clamp(9px, calc(var(--cell-size)*0.26), 16px); opacity: .9; }

  .hud { background: color-mix(in oklab, var(--panel) 85%, black 15%); border: 1px solid #334155;
    border-radius: 16px; padding: 14px; position: sticky; top: 16px; box-shadow: 0 10px 40px rgba(0,0,0,.35); }
  .hud h1 { font-size: 18px; margin: 0 0 10px; }
  .row { display: flex; gap: 8px; align-items: center; margin: 6px 0; flex-wrap: wrap; }
  .tag { padding: 2px 8px; border-radius: 999px; background: #0b1222; border: 1px solid #1f2937; font-size: 12px; }
  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 10px; border-radius: 10px; background: #0b1222;
    border: 1px solid #334155; color: var(--text); cursor: pointer; user-select: none; transition: .15s transform ease, .15s background ease, .15s border-color ease; }
  .btn:hover { transform: translateY(-1px); background: #0f1a30; border-color: #3b82f6; }
  .btn.primary { background: #13213f; border-color: #3b82f6; }
  .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
  .card { background: #0b1222; border: 1px solid #1f2937; border-radius: 12px; padding: 10px; font-size: 14px; }
  .big { font-size: 20px; font-weight: 800; }
  .help { font-size: 12px; opacity: .85; line-height: 1.5; }
  .toast { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: #102b1f; border: 1px solid #22c55e; color: #d1fae5;
    padding: 8px 12px; border-radius: 10px; box-shadow: 0 8px 30px rgba(0,0,0,.3); font-size: 13px; opacity: 0; pointer-events: none; transition: .2s opacity ease; }
  .toast.show { opacity: 1; }
</style>
</head>
<body>
<div class="app">
  <div class="board-wrap" id="boardWrap">
    <div id="board" class="board" aria-label="periodic-board"></div>
    <div id="falling" class="falling" style="display:none">
      <div class="wrap">
        <div class="sym">He</div>
        <div class="jp">ãƒ˜ãƒªã‚¦ãƒ </div>
      </div>
    </div>
  </div>

  <aside class="hud" aria-label="hud">
    <h1>å‘¨æœŸè¡¨ãƒ†ãƒˆãƒªã‚¹ v2</h1>
    <div class="row">
      <button id="restart" class="btn primary">â†» ãƒªã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆEnterï¼‰</button>
      <button id="toggleMode" class="btn">M: ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
      <span id="modeTag" class="tag">å…¨ç¯„å›²</span>
    </div>
    <div class="stats">
      <div class="card">ã‚¹ã‚³ã‚¢<br><span id="score" class="big">0</span></div>
      <div class="card">ã‚³ãƒ³ãƒœ<br><span id="combo" class="big">0</span></div>
      <div class="card">ãƒŸã‚¹<br><span id="miss" class="big">0/5</span></div>
      <div class="card">é…ç½®æ¸ˆã¿<br><span id="placed" class="big">0</span></div>
    </div>
    <div class="card" style="margin-top:10px">
      å‡ºé¡Œãƒ¢ãƒ¼ãƒ‰ï¼š<br>
      <div class="help">å…¨ç¯„å›²ï¼<b>Z1ã€œ36</b> ï¼‹ <b>1,2,17,18æ—ã®å…¨å…ƒç´ </b>ï¼ æ—é›†ä¸­ï¼<b>1,2,17,18æ—ã®ã¿</b></div>
    </div>
    <div class="card" style="margin-top:10px">
      <div class="help">
        æ“ä½œï¼šâ† â†’ ç§»å‹•ï¼â†“ åŠ é€Ÿï¼Space ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼P ä¸€æ™‚åœæ­¢ï¼M ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼Enter ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ<br>
        iPadï¼š<b>å·¦å³ã‚¹ãƒ¯ã‚¤ãƒ—</b>ï¼å·¦å³ç§»å‹•ã€<b>ä¸‹ã‚¹ãƒ¯ã‚¤ãƒ—</b>ï¼ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã€<b>ã‚¿ãƒƒãƒ—</b>ï¼å°‘ã—åŠ é€Ÿ
      </div>
    </div>
  </aside>
</div>
<div id="toast" class="toast">Great!</div>

<script>
/** ===================== å…ƒç´ ãƒ‡ãƒ¼ã‚¿ =====================
 * å¯¾è±¡ï¼š
 *  - Z=1..36ï¼ˆHã€œKrï¼‰ã™ã¹ã¦
 *  - 1/2/17/18æ—ã¯å‘¨æœŸ7ã¾ã§å…¨å“¡ï¼ˆRb, Sr, Cs, Ba, Fr, Ra / I, At, Ts / Xe, Rn, Og ãªã©ï¼‰
 */
const BASE_SET_1to36 = [
  [1,"H","æ°´ç´ ","Hydrogen",1,1], [2,"He","ãƒ˜ãƒªã‚¦ãƒ ","Helium",1,18],
  [3,"Li","ãƒªãƒã‚¦ãƒ ","Lithium",2,1], [4,"Be","ãƒ™ãƒªãƒªã‚¦ãƒ ","Beryllium",2,2],
  [5,"B","ãƒ›ã‚¦ç´ ","Boron",2,13], [6,"C","ç‚­ç´ ","Carbon",2,14],
  [7,"N","çª’ç´ ","Nitrogen",2,15], [8,"O","é…¸ç´ ","Oxygen",2,16],
  [9,"F","ãƒ•ãƒƒç´ ","Fluorine",2,17], [10,"Ne","ãƒã‚ªãƒ³","Neon",2,18],
  [11,"Na","ãƒŠãƒˆãƒªã‚¦ãƒ ","Sodium",3,1], [12,"Mg","ãƒã‚°ãƒã‚·ã‚¦ãƒ ","Magnesium",3,2],
  [13,"Al","ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ","Aluminium",3,13], [14,"Si","ã‚±ã‚¤ç´ ","Silicon",3,14],
  [15,"P","ãƒªãƒ³","Phosphorus",3,15], [16,"S","ç¡«é»„","Sulfur",3,16],
  [17,"Cl","å¡©ç´ ","Chlorine",3,17], [18,"Ar","ã‚¢ãƒ«ã‚´ãƒ³","Argon",3,18],
  [19,"K","ã‚«ãƒªã‚¦ãƒ ","Potassium",4,1], [20,"Ca","ã‚«ãƒ«ã‚·ã‚¦ãƒ ","Calcium",4,2],
  [21,"Sc","ã‚¹ã‚«ãƒ³ã‚¸ã‚¦ãƒ ","Scandium",4,3], [22,"Ti","ãƒã‚¿ãƒ³","Titanium",4,4],
  [23,"V","ãƒãƒŠã‚¸ã‚¦ãƒ ","Vanadium",4,5], [24,"Cr","ã‚¯ãƒ­ãƒ ","Chromium",4,6],
  [25,"Mn","ãƒãƒ³ã‚¬ãƒ³","Manganese",4,7], [26,"Fe","é‰„","Iron",4,8],
  [27,"Co","ã‚³ãƒãƒ«ãƒˆ","Cobalt",4,9], [28,"Ni","ãƒ‹ãƒƒã‚±ãƒ«","Nickel",4,10],
  [29,"Cu","éŠ…","Copper",4,11], [30,"Zn","äºœé‰›","Zinc",4,12],
  [31,"Ga","ã‚¬ãƒªã‚¦ãƒ ","Gallium",4,13], [32,"Ge","ã‚²ãƒ«ãƒãƒ‹ã‚¦ãƒ ","Germanium",4,14],
  [33,"As","ãƒ’ç´ ","Arsenic",4,15], [34,"Se","ã‚»ãƒ¬ãƒ³","Selenium",4,16],
  [35,"Br","è‡­ç´ ","Bromine",4,17], [36,"Kr","ã‚¯ãƒªãƒ—ãƒˆãƒ³","Krypton",4,18]
];

const GROUPS_EXTRA = [
  // 1æ—ï¼šH, Li, Na, K, Rb, Cs, Fr
  [37,"Rb","ãƒ«ãƒ“ã‚¸ã‚¦ãƒ ","Rubidium",5,1], [55,"Cs","ã‚»ã‚·ã‚¦ãƒ ","Cesium",6,1], [87,"Fr","ãƒ•ãƒ©ãƒ³ã‚·ã‚¦ãƒ ","Francium",7,1],
  // 2æ—ï¼šBe, Mg, Ca, Sr, Ba, Ra
  [38,"Sr","ã‚¹ãƒˆãƒ­ãƒ³ãƒã‚¦ãƒ ","Strontium",5,2], [56,"Ba","ãƒãƒªã‚¦ãƒ ","Barium",6,2], [88,"Ra","ãƒ©ã‚¸ã‚¦ãƒ ","Radium",7,2],
  // 17æ—ï¼šF, Cl, Br, I, At, Ts
  [53,"I","ãƒ¨ã‚¦ç´ ","Iodine",5,17], [85,"At","ã‚¢ã‚¹ã‚¿ãƒãƒ³","Astatine",6,17], [117,"Ts","ãƒ†ãƒã‚·ãƒ³","Tennessine",7,17],
  // 18æ—ï¼šHe, Ne, Ar, Kr, Xe, Rn, Og
  [54,"Xe","ã‚­ã‚»ãƒãƒ³","Xenon",5,18], [86,"Rn","ãƒ©ãƒ‰ãƒ³","Radon",6,18], [118,"Og","ã‚ªã‚¬ãƒã‚½ãƒ³","Oganesson",7,18]
];

const ELEMENTS_ALL = [...BASE_SET_1to36, ...GROUPS_EXTRA]
  .map(([z,sym,jp,en,period,group])=>({z,sym,jp,en,period,group}))
  // period 1ã®ç„¡åŠ¹ãƒã‚¹ï¼ˆ2-17æ—ï¼‰ãªã©ã¯å¾Œã§isValidCellã§ç®¡ç†
  .sort((a,b)=>a.z-b.z);

// ç›¤é¢ï¼šperiod=1..7, group=1..18
const ROWS = 7, COLS = 18;

/** æœ‰åŠ¹ãƒã‚¹åˆ¤å®šï¼ˆMVPï¼šperiod 1ã¯1ã¨18ã®ã¿ã€‚ä»–ã¯1..18ã‚’è¨±å®¹ï¼‰ */
function isValidCell(period, group) {
  if (period === 1) return group === 1 || group === 18; // H, He
  if (period >= 2 && period <= 7) return group >= 1 && group <= 18;
  return false;
}

// ===== DOM =====
const boardWrap = document.getElementById('boardWrap');
const boardEl = document.getElementById('board');
const fallingEl = document.getElementById('falling');
const scoreEl = document.getElementById('score');
const comboEl = document.getElementById('combo');
const missEl = document.getElementById('miss');
const placedEl = document.getElementById('placed');
const modeTag = document.getElementById('modeTag');
const toastEl = document.getElementById('toast');

// ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆ
const grid = [];
(function buildGrid(){
  boardEl.innerHTML = '';
  for (let r=1;r<=ROWS;r++){
    const rowArr = [];
    for (let c=1;c<=COLS;c++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.r = r; cell.dataset.c = c;
      if (!isValidCell(r,c)) cell.classList.add('invalid');
      const sm = document.createElement('div');
      sm.className = 'small';
      if (isValidCell(r,c)) sm.textContent = `${r},${c}`;
      cell.appendChild(sm);
      boardEl.appendChild(cell);
      rowArr.push({filled:false, el:cell});
    }
    grid.push(rowArr);
  }
})();

// ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šç”»é¢å¹…ã„ã£ã±ã„ã«ã‚»ãƒ«ã‚’è‡ªå‹•èª¿æ•´ =====
function updateCellSize(){
  const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-gap'));
  const wrapW = boardWrap.clientWidth - 24; // å†…å´ä½™ç™½ã®ç›®å®‰
  const size = Math.max(20, Math.floor((wrapW - (COLS-1)*gap) / COLS));
  document.documentElement.style.setProperty('--cell-size', size + 'px');
}
window.addEventListener('resize', updateCellSize);
updateCellSize();

// ===== çŠ¶æ…‹ =====
let modeFocusGroups = false; // false: å…¨ç¯„å›², true: æ—é›†ä¸­ï¼ˆ1/2/17/18ï¼‰
let score=0, combo=0, misses=0, placed=0;
let active=null; let timer=null; let paused=false;
const BASE_SPEED=900; let speed=BASE_SPEED;
const MAX_MISS=5;

// æ—¢ã«é…ç½®ã•ã‚ŒãŸå…ƒç´ ï¼ˆzï¼‰
const placedSet = new Set();
// ã‚¯ãƒªã‚¢å¯¾è±¡ï¼ˆå…¨ç¯„å›²ãƒ¢ãƒ¼ãƒ‰ã®å…¨è¦ç´ ã‚’åŸºæº–ã«ï¼‰
const TARGET_SET_ALL = new Set(ELEMENTS_ALL.map(e=>e.z));
const TARGET_SET_FOCUS = new Set(ELEMENTS_ALL.filter(e=>[1,2,17,18].includes(e.group)).map(e=>e.z));

function showToast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 900); }
function randChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function pool(){
  const base = modeFocusGroups ? ELEMENTS_ALL.filter(e=>[1,2,17,18].includes(e.group)) : ELEMENTS_ALL;
  return base.filter(e=>!placedSet.has(e.z)); // æ—¢ã«åŸ‹ã¾ã£ã¦ã„ã‚‹å…ƒç´ ã¯è½ã¨ã•ãªã„
}

function spawn(){
  const p = pool();
  if (p.length === 0){
    // ã‚¯ãƒªã‚¢
    gameClear();
    return;
  }
  const e = randChoice(p);
  active = { ...e, x: Math.min(Math.max(e.group,1),COLS), y: 0 };
  fallingEl.querySelector('.sym').textContent = `${e.sym}`;
  fallingEl.querySelector('.jp').textContent = `${e.jp}`;
  fallingEl.style.display = 'grid';
  renderActive();
}

function renderActive(){
  if (!active) return;
  const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size'));
  const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-gap'));
  const cw = size + gap, ch = size + gap;
  const centerX = (active.x-1)*cw + size/2 + gap;
  // ç›®æ¨™è¡Œã®ä¸­å¿ƒ
  const targetY = (active.period-1)*ch + size/2 + gap;
  const clampedY = Math.min(active.y, targetY);
  fallingEl.style.left = `${centerX}px`;
  fallingEl.style.top = `${clampedY}px`;
}

function step(){
  if (paused || !active) return;
  const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size'));
  const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-gap'));
  const ch = size + gap; const targetY = (active.period-1)*ch + size/2 + gap;
  active.y += Math.max(2, ch/8);
  if (active.y >= targetY - 1){
    const ok = (active.x === active.group);
    place(ok);
    return;
  }
  renderActive();
}

function place(ok){
  const r = active.period, c = active.group;
  const cell = grid[r-1][c-1];
  cell.filled = true; cell.el.classList.add('filled');
  cell.el.textContent = `${active.sym} ${active.jp}`;
  const sm = document.createElement('div'); sm.className='small'; sm.textContent = `${r},${c}`; cell.el.appendChild(sm);
  placedSet.add(active.z);

  if (ok){
    const add = 100 + combo*20; score += add; combo += 1; placed += 1; showToast(`æ­£è§£ï¼ +${add}`);
  } else {
    misses += 1; combo = 0; showToast(`ãƒŸã‚¹ï¼ æ­£è§£ã¯ [${r},${c}]`);
  }
  updateHUD();
  fallingEl.style.display = 'none';
  active = null;

  // ã‚¯ãƒªã‚¢åˆ¤å®šï¼ˆç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒå…¨ã¦åŸ‹ã¾ã£ãŸã‚‰ï¼‰
  const targetSet = modeFocusGroups ? TARGET_SET_FOCUS : TARGET_SET_ALL;
  let done = true; for (const z of targetSet){ if (!placedSet.has(z)) { done = false; break; } }
  if (done) { gameClear(); return; }
  if (misses >= MAX_MISS){ gameOver(); return; }
  spawn();
}

function updateHUD(){
  scoreEl.textContent = score; comboEl.textContent = combo; missEl.textContent = `${misses}/${MAX_MISS}`; placedEl.textContent = placed;
}

function clearBoard(){
  placedSet.clear();
  for (let r=1;r<=ROWS;r++){
    for (let c=1;c<=COLS;c++){
      const cell = grid[r-1][c-1];
      cell.filled = false; cell.el.className = 'cell' + (isValidCell(r,c)?'':' invalid');
      cell.el.textContent = '';
      const sm = document.createElement('div'); sm.className='small'; if (isValidCell(r,c)) sm.textContent = `${r},${c}`; cell.el.appendChild(sm);
    }
  }
}

function loop(){ step(); }

function start(reset=false){
  if (reset){ score=0; combo=0; misses=0; placed=0; clearBoard(); }
  updateHUD(); paused=false; speed=BASE_SPEED; if (timer) clearInterval(timer); timer = setInterval(loop, speed);
  if (!active) spawn();
}

function togglePause(){ if (!timer) return; paused = !paused; showToast(paused? 'ä¸€æ™‚åœæ­¢' : 'å†é–‹'); }
function toggleMode(){ modeFocusGroups = !modeFocusGroups; modeTag.textContent = modeFocusGroups ? 'æ—é›†ä¸­ (1/2/17/18)' : 'å…¨ç¯„å›²'; showToast(modeFocusGroups? 'æ—é›†ä¸­' : 'å…¨ç¯„å›²'); }
function gameOver(){ clearInterval(timer); timer=null; active=null; showToast(`ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ã‚¹ã‚³ã‚¢:${score}`); }
function gameClear(){ clearInterval(timer); timer=null; active=null; showToast('ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ğŸ‰'); }

// ===== å…¥åŠ›ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰ =====
function tickFastOnce(){ if (!active) return; const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size')); const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-gap')); const ch = size + gap; active.y += ch * .6; step(); }
function hardDrop(){ if (!active) return; const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size')); const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-gap')); const ch = size + gap; const targetY = (active.period-1)*ch + size/2 + gap; active.y = targetY; step(); }

document.addEventListener('keydown', (e)=>{
  if (!active && e.key === 'Enter'){ start(true); return; }
  if (e.key === 'Enter'){ start(true); return; }
  if (e.key.toLowerCase() === 'p'){ togglePause(); return; }
  if (e.key.toLowerCase() === 'm'){ toggleMode(); return; }
  if (!active) return;
  if (e.key === 'ArrowLeft'){ active.x = Math.max(1, active.x-1); renderActive(); }
  else if (e.key === 'ArrowRight'){ active.x = Math.min(COLS, active.x+1); renderActive(); }
  else if (e.key === 'ArrowDown'){ tickFastOnce(); }
  else if (e.code === 'Space'){ hardDrop(); }
  e.preventDefault();
});

// ===== ã‚¿ãƒƒãƒæ“ä½œï¼ˆiPadï¼‰ =====
let touchStartX=0, touchStartY=0, touchMoved=false;
const SWIPE_THRESHOLD = 24; // px
boardWrap.addEventListener('touchstart', (ev)=>{
  const t = ev.changedTouches[0]; touchStartX = t.clientX; touchStartY = t.clientY; touchMoved = false; }, {passive:true});
boardWrap.addEventListener('touchmove', (ev)=>{
  if (!active) return;
  const t = ev.changedTouches[0]; const dx = t.clientX - touchStartX; const dy = t.clientY - touchStartY;
  if (Math.abs(dx) > Math.abs(dy)){
    if (Math.abs(dx) > SWIPE_THRESHOLD){
      if (dx > 0){ active.x = Math.min(COLS, active.x+1); } else { active.x = Math.max(1, active.x-1); }
      renderActive(); touchStartX = t.clientX; touchStartY = t.clientY; touchMoved = true; // é€£ç¶šç§»å‹•å¯
    }
  } else {
    if (dy > SWIPE_THRESHOLD){ hardDrop(); touchMoved = true; }
  }
}, {passive:true});
boardWrap.addEventListener('touchend', (ev)=>{
  if (!active) return;
  if (!touchMoved){ tickFastOnce(); } // ã‚¿ãƒƒãƒ—ï¼šå°‘ã—åŠ é€Ÿ
});

// ===== ãƒœã‚¿ãƒ³ =====
Document.prototype.q = Document.prototype.querySelector; // å°ãƒ¯ã‚¶
const $ = (sel)=>document.querySelector(sel);
$('#restart').addEventListener('click', ()=>start(true));
$('#toggleMode').addEventListener('click', toggleMode);

// è‡ªå‹•é–‹å§‹
start(true);
</script>
</body>
</html>
