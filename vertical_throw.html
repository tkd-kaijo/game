<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>鉛直投げ上げゲーム〜5球で10点取れ！〜</title>
<style>
body{background:#0b1022;color:#fff;font-family:sans-serif;margin:0;padding:0;text-align:center}
h1{font-size:1.6em;margin:10px 0}
#scoreHUD{font-size:1.2em;margin:6px 0}
#challengeTextHUD{font-size:1.4em;margin:6px 0;color:#ff5b5b !important;font-weight:bold}
#roundHUD{font-size:1.2em;margin:6px 0}
#speedLabel{font-size:1.4em;color:#ff5b5b !important;margin:6px 0}
.scene{position:relative;margin:auto;background:#122;padding:4px;width:90%;max-width:400px;height:400px;overflow:hidden}
.ball{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:20px;height:20px;border-radius:50%;background:red}
.meterLine{position:absolute;left:0;width:100%;height:1px;background:rgba(255,255,255,.3)}
.meterLabel{position:absolute;left:2px;font-size:10px;color:#fff}
.HLine{position:absolute;left:0;width:100%;height:1px;background:red}
button{margin:8px;padding:8px 16px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
#resultBox{margin-top:12px}
/* 提出フォーム */
.submitBox{display:none;margin-top:12px;padding:12px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(255,255,255,.06)}
.submitBox h3{margin:0 0 8px 0;font-size:16px}
.submitRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.submitRow input[type="text"]{flex:1;min-width:180px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#0f1430;color:#fff;font-size:16px}
.submitRow button{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;color:#03131a;background:linear-gradient(180deg, #b1ffd1, #7affaf);box-shadow:0 8px 22px rgba(122,255,175,.28)}
.helpText{font-size:12px;color:#cfe3ff;opacity:.9;margin-top:6px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#0b1022;color:#eafff3;padding:10px 14px;border:1px solid rgba(255,255,255,.1);border-radius:10px;display:none;z-index:9999}
</style>
</head>
<body>
  <h1>鉛直投げ上げゲーム〜5球で10点取れ！〜</h1>
  <div id="roundHUD">ラウンド1/5</div>
  <div id="challengeTextHUD">課題：最高到達高度 19.6 m を目指せ</div>
  <div id="scoreHUD">スコア: 0点</div>
  <div id="speedLabel">速度: 0 m/s</div>
  <div class="scene" id="scene">
    <div class="ball" id="ball"></div>
  </div>
  <button id="startBtn">投射！</button>
  <div id="resultBox"></div>
  <div class="submitBox" id="submitBox" aria-live="polite">
    <h3>提出</h3>
    <div class="submitRow">
      <label for="studentId">学籍番号：</label>
      <input id="studentId" type="text" placeholder="例：123456" inputmode="numeric" />
      <button id="submitBtn">送信</button>
    </div>
    <div class="helpText" id="submitHelp">5回分の成績と一緒に提出されます。</div>
  </div>
  <div class="toast" id="toast"></div>
<script>
// ゲーム状態変数
let score=0, round=1, maxRounds=5, lastGainedPoints=0;
const roundsDetail=[];

// Googleフォーム送信設定
const CONFIG={
  SUBMIT_MODE:'google_forms',
  GOOGLE_FORMS:{
    url:'https://docs.google.com/forms/d/e/1FAIpQLSdclzAB4YrLDhGSKkAoOC4IzF91eYF0uaWZuzXnJkZvBXGC7Q/formResponse',
    entry:{
      studentId:'entry.196095964',
      totalScore:'entry.1303752079',
      timestamp:'entry.1852796806'
    }
  }
};

// UI
const scoreHUD=document.getElementById('scoreHUD');
const roundHUD=document.getElementById('roundHUD');
const challengeTextHUD=document.getElementById('challengeTextHUD');
const speedLabel=document.getElementById('speedLabel');
const resultBox=document.getElementById('resultBox');
const submitBox=document.getElementById('submitBox');
const submitBtn=document.getElementById('submitBtn');
const studentIdInput=document.getElementById('studentId');
const toast=document.getElementById('toast');

function showToast(msg){toast.textContent=msg;toast.style.display='block';setTimeout(()=>toast.style.display='none',2000);}
function showSubmitBox(){submitBox.style.display='block';studentIdInput.focus();}
async function submitResult(){
  const studentId=studentIdInput.value.trim();
  if(!studentId){showToast('学籍番号を入力してください');return;}
  try{
    const fd=new FormData();
    fd.append(CONFIG.GOOGLE_FORMS.entry.studentId,studentId);
    fd.append(CONFIG.GOOGLE_FORMS.entry.totalScore,String(score));
    fd.append(CONFIG.GOOGLE_FORMS.entry.timestamp,new Date().toLocaleString());
    await fetch(CONFIG.GOOGLE_FORMS.url,{method:'POST',mode:'no-cors',body:fd});
    showToast('送信しました！（Googleフォーム）');
    submitBtn.disabled=true;studentIdInput.disabled=true;
  }catch(e){console.error(e);showToast('送信に失敗しました');}
}
submitBtn.addEventListener('click',submitResult);

// ダミーで最終結果表示
function endGame(){
  resultBox.innerHTML=`<p>5回目の得点：+${lastGainedPoints}点</p><p>全5回の合計スコア：${score}点</p>`;
  showSubmitBox();
}
document.getElementById('startBtn').addEventListener('click',()=>{
  lastGainedPoints=3;score+=3;scoreHUD.textContent=`スコア: ${score}点`;
  round=maxRounds;endGame();
});
</script>
</body>
</html>
